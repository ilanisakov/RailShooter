/////////////////////////////////////////////////////////////////////
// File: MyOctTree.h
// DSA2 PokemanSafari_M4
// Authors:
//      Ilan Isakov
//		Marty Kurtz
//		Mary Spencer
//
// Description:
//
/////////////////////////////////////////////////////////////////////

#ifndef __MYOCTTREE_H__
#define __MYOCTTREE_H__

//TODO change?
#include "MyBOClass.h"

#define OCT_SIZE      8
#define OCT_MAX_DEPTH 5

class MyOctTree {

private:
	MeshManagerSingleton* m_pMeshMngr = nullptr;

	MyOctTree* m_parent = nullptr;     //Node parent
	MyOctTree* m_child[OCT_SIZE];      //Children Nodes

	int m_subdivisions;              //Subdivisions from this cell
	float m_radius;                  //radius of cell
	vector3 m_center;                //center of cell

	std::map<String, MyBOClass*> m_octMap; //oct cell occupants
	typedef std::map<String, MyBOClass*>::iterator t_octMapIt;

	MyOctTree* m_ancestorList[OCT_MAX_DEPTH+1];
	int m_ancesterDepth;
	std::vector<std::vector<int>>* m_IdxList;

	/////////////////////////////////////////////////////////////////
	// Init() - initialize class data members
	/////////////////////////////////////////////////////////////////
	void Init();

	/////////////////////////////////////////////////////////////////
	// Subdivide() - 
	/////////////////////////////////////////////////////////////////
	void Subdivide();

	/////////////////////////////////////////////////////////////////
	// CalcChildCenter()
	/////////////////////////////////////////////////////////////////
	vector3 CalcChildCenter(int idx);

	/////////////////////////////////////////////////////////////////
	// DetermineOctant() - dtermines what octant a point is in
	/////////////////////////////////////////////////////////////////
	int DetermineOctant(vector3 point);

	/////////////////////////////////////////////////////////////////
	// RemoveObject()
	/////////////////////////////////////////////////////////////////
	bool RemoveObject(MyOctTree* node, MyBOClass* obj);

	/////////////////////////////////////////////////////////////////
	// TraverseAux()
	/////////////////////////////////////////////////////////////////
	void TraverseAux(MyOctTree* node);

public:

	/////////////////////////////////////////////////////////////////
	// Constructor
	/////////////////////////////////////////////////////////////////
	MyOctTree( vector3 center, int depth, float width);

	/////////////////////////////////////////////////////////////////
	// Copy Constructor
	/////////////////////////////////////////////////////////////////
	MyOctTree(MyOctTree const& other);

	/////////////////////////////////////////////////////////////////
	// Copy Assignment Operator
	/////////////////////////////////////////////////////////////////
	MyOctTree& operator=(MyOctTree const& other);

	/////////////////////////////////////////////////////////////////
	// DisplayBox() - display box of octant and suboctants
	/////////////////////////////////////////////////////////////////
	void DisplayBox();

	/////////////////////////////////////////////////////////////////
	// AddObject()
	/////////////////////////////////////////////////////////////////
	void AddObject(MyOctTree* tree, MyBOClass* obj);

	/////////////////////////////////////////////////////////////////
	// UpdateObject()
	/////////////////////////////////////////////////////////////////
	void UpdateObject(MyOctTree* root, MyBOClass* obj);

	/////////////////////////////////////////////////////////////////
	// CollisionTraverse()
	/////////////////////////////////////////////////////////////////
	void CollisionTraverse(std::vector<std::vector<int>>* idxList);

	/////////////////////////////////////////////////////////////////
	// GetCenter() - returns the center of the octant cell
	/////////////////////////////////////////////////////////////////
	vector3 GetCenter();

	/////////////////////////////////////////////////////////////////
	// GetSize() - returns the size of the octant cell
	/////////////////////////////////////////////////////////////////
	float GetSize();

	/////////////////////////////////////////////////////////////////
	// Release() - deallocate any memory
	/////////////////////////////////////////////////////////////////
	void Release();

	/////////////////////////////////////////////////////////////////
	// Destructor()
	/////////////////////////////////////////////////////////////////
	~MyOctTree();
};




#endif /*__MYOCTTREE_H__*/
